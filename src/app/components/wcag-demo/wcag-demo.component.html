<div class="wcag-demo-container">
  <header class="wcag-header">
    <h1>Demo de Accesibilidad Web - WCAG 2.1</h1>
    <p class="intro">
      Esta página interactiva muestra ejemplos de criterios WCAG 2.1. Haciendo clic en cada criterio
      se muestra ejemplos de código no accesible vs accesible.
    </p>
  </header>

  <div class="layout-actions" aria-label="Opciones de diseño">
    <button
      type="button"
      class="sidebar-toggle"
      (click)="toggleSidebar()"
      [attr.aria-expanded]="!isSidebarCollapsed"
      [attr.aria-label]="isSidebarCollapsed ? 'Mostrar información adicional' : 'Ocultar información adicional'"
      aria-controls="wcag-sidebar"
    >
      <span class="sidebar-toggle-icon" aria-hidden="true">{{ isSidebarCollapsed ? '<' : '>' }}</span>
    </button>
  </div>

  <main class="wcag-main" [class.sidebar-collapsed]="isSidebarCollapsed">
    <div class="cases-list">
      <section
        *ngFor="let group of wcagCaseGroups; trackBy: trackByPillar"
        class="pillar-group"
        [attr.aria-label]="group.label"
      >
        <h2 class="pillar-title">{{ group.label }}</h2>

        <div class="pillar-cases">
          <div
            *ngFor="let wcagCase of group.cases; trackBy: trackByCaseId"
            class="wcag-case"
            [class.expanded]="isExpanded(wcagCase.id)"
          >
            <button
              class="case-header"
              (click)="toggleCase(wcagCase.id)"
              [attr.aria-expanded]="isExpanded(wcagCase.id)"
              [attr.aria-controls]="'case-content-' + wcagCase.id"
            >
              <span class="criterion-badge">{{ wcagCase.criterion }}</span>
              <span class="case-title">{{ wcagCase.name }}</span>
              <span class="toggle-icon" aria-hidden="true">
                {{ isExpanded(wcagCase.id) ? '▼' : '▶' }}
              </span>
            </button>

            <div
              [id]="'case-content-' + wcagCase.id"
              class="case-content"
              *ngIf="isExpanded(wcagCase.id)"
            >
              <div class="case-description">
                <h3>Descripción</h3>
                <p>{{ wcagCase.description }}</p>
              </div>

              <div class="preview-actions" aria-label="Acciones de vista previa">
                <button
                  type="button"
                  class="preview-toggle"
                  (click)="toggleHtml(wcagCase.id)"
                  [attr.aria-pressed]="isHtmlShown(wcagCase.id)"
                >
                  {{ isHtmlShown(wcagCase.id) ? 'Ocultar HTML' : 'Mostrar HTML' }}
                </button>
              </div>

              <div class="preview-section">
                <h3 class="preview-title">Vista previa (HTML renderizado)</h3>
                <p class="preview-hint">
                  Nota: se renderiza en un <strong>iframe</strong> con <strong>sandbox</strong> (aislado). Puedes inspeccionarlo con
                  DevTools.
                </p>

                <div class="preview-grid" [class.single-column]="!isSolutionRevealed(wcagCase.id)">
                  <div class="preview-block inaccessible">
                    <h4>❌ No Accesible (render)</h4>
                    <iframe
                      class="preview-frame"
                      title="Vista previa: no accesible"
                      sandbox
                      [srcdoc]="trustedSrcDoc(buildPreviewSrcDoc(getInaccessibleHtml(wcagCase)))"
                    ></iframe>
                  </div>

                  <div class="preview-block accessible" *ngIf="isSolutionRevealed(wcagCase.id)">
                    <h4>✅ Accesible (render)</h4>
                    <iframe
                      class="preview-frame"
                      title="Vista previa: accesible"
                      sandbox
                      [srcdoc]="trustedSrcDoc(buildPreviewSrcDoc(getAccessibleHtml(wcagCase)))"
                    ></iframe>
                  </div>
                </div>
              </div>

              <div
                class="code-comparison"
                [class.single-column]="!isSolutionRevealed(wcagCase.id)"
                *ngIf="isHtmlShown(wcagCase.id)"
              >
                <div class="code-block inaccessible">
                  <div class="code-header">
                    <h4>❌ No Accesible (editable)</h4>
                    <button type="button" class="code-reset" (click)="resetInaccessibleHtml(wcagCase)">Restablecer</button>
                  </div>
                  <textarea
                    class="code-editor"
                    spellcheck="false"
                    [value]="getInaccessibleHtml(wcagCase)"
                    (input)="updateInaccessibleHtml(wcagCase.id, $any($event.target).value)"
                    aria-label="HTML no accesible (editable)"
                  ></textarea>
                </div>

                <div class="code-block accessible" *ngIf="isSolutionRevealed(wcagCase.id)">
                  <div class="code-header">
                    <h4>✅ Accesible (editable)</h4>
                    <button type="button" class="code-reset" (click)="resetAccessibleHtml(wcagCase)">Restablecer</button>
                  </div>
                  <textarea
                    class="code-editor"
                    spellcheck="false"
                    [value]="getAccessibleHtml(wcagCase)"
                    (input)="updateAccessibleHtml(wcagCase.id, $any($event.target).value)"
                    aria-label="HTML accesible (editable)"
                  ></textarea>
                </div>
              </div>

              <div class="solution-actions" aria-label="Acciones de solución">
                <button
                  type="button"
                  class="solution-toggle"
                  (click)="toggleSolution(wcagCase.id)"
                  [attr.aria-pressed]="isSolutionRevealed(wcagCase.id)"
                >
                  {{ isSolutionRevealed(wcagCase.id) ? 'Ocultar solución' : 'Mostrar solución' }}
                </button>
              </div>

              <div class="case-explanation">
                <h4>Explicación</h4>
                <p>{{ wcagCase.explanation }}</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <aside
      *ngIf="!isSidebarCollapsed"
      id="wcag-sidebar"
      class="wcag-sidebar"
      role="complementary"
      aria-label="Información adicional"
    >
      <h2>Niveles WCAG</h2>
      <dl>
        <dt><strong>A</strong></dt>
        <dd>Nivel básico de conformidad.</dd>

        <dt><strong>AA</strong></dt>
        <dd>Recomendado. Mejora accesibilidad para la mayoría.</dd>

        <dt><strong>AAA</strong></dt>
        <dd>Máximo nivel. Accesibilidad óptima.</dd>
      </dl>

      <h2>Recursos</h2>
      <ul>
        <li>
          <a href="https://www.w3.org/TR/WCAG21/" target="_blank" rel="noopener noreferrer">
            WCAG 2.1 oficial
          </a>
        </li>
        <li>
          <a href="https://www.w3.org/WAI/" target="_blank" rel="noopener noreferrer">
            Web Accessibility Initiative (WAI)
          </a>
        </li>
      </ul>
    </aside>
  </main>
</div>
