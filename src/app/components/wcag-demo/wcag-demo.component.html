<div class="wcag-demo-container">
  <header class="wcag-header">
    <h1>Demo de Accesibilidad Web - WCAG 2.1</h1>
    <p class="intro">
      Esta página interactiva muestra ejemplos de criterios WCAG 2.1.
    </p>
  </header>

  <main class="wcag-main">
    <div class="cases-list">
      <section
        *ngFor="let group of wcagCaseGroups; trackBy: trackByPillar"
        class="pillar-group"
        [attr.aria-label]="group.label"
      >
        <h2 class="pillar-title">{{ group.label }}</h2>

        <div class="pillar-cases">
          <div
            *ngFor="let wcagCase of group.cases; trackBy: trackByCaseId"
            class="wcag-case"
            [class.expanded]="isExpanded(wcagCase.id)"
          >
            <button
              class="case-header"
              (click)="toggleCase(wcagCase.id)"
              [attr.aria-expanded]="isExpanded(wcagCase.id)"
              [attr.aria-controls]="'case-content-' + wcagCase.id"
            >
              <span class="criterion-badge">{{ wcagCase.criterion }}</span>
              <span class="case-title">
                <span class="important-icon" *ngIf="wcagCase.important" >⚠️</span>
                {{ wcagCase.name }}
              </span>
              <span class="toggle-icon" aria-hidden="true">
                {{ isExpanded(wcagCase.id) ? '▼' : '▶' }}
              </span>
            </button>

            <div
              [id]="'case-content-' + wcagCase.id"
              class="case-content"
              *ngIf="isExpanded(wcagCase.id)"
            >
              <div class="case-description">
                <h3>Descripción</h3>
                <p>{{ wcagCase.description }}</p>
              </div>

              <div class="preview-section">
                <h3 class="preview-title">Vista previa</h3>
                <!-- <p class="preview-hint">
                  Nota: estos ejemplos se renderizan como <strong>ng-template</strong> directamente en el DOM.
                </p> -->

                <div class="preview-grid" [class.single-column]="!isSolutionRevealed(wcagCase.id)">
                  <div class="preview-block inaccessible">
                    <h4>❌ No Accesible</h4>
                    <ng-container *ngIf="hasCaseTemplate(wcagCase.inaccessibleTemplateKey); else missingTemplate">
                      <div class="template-preview" role="group" aria-label="Vista previa template: no accesible">
                        <ng-container
                          *ngTemplateOutlet="getCaseTemplate(wcagCase.inaccessibleTemplateKey); context: templateContext(wcagCase, 'inaccessible')"
                        ></ng-container>
                      </div>
                    </ng-container>
                  </div>

                  <div class="preview-block accessible" *ngIf="isSolutionRevealed(wcagCase.id)">
                    <h4>✅ Accesible</h4>
                    <ng-container *ngIf="hasCaseTemplate(wcagCase.accessibleTemplateKey); else missingTemplate">
                      <div class="template-preview" role="group" aria-label="Vista previa template: accesible">
                        <ng-container
                          *ngTemplateOutlet="getCaseTemplate(wcagCase.accessibleTemplateKey); context: templateContext(wcagCase, 'accessible')"
                        ></ng-container>
                      </div>
                    </ng-container>
                  </div>
                </div>

                <ng-template #missingTemplate>
                  <div class="template-preview" role="note">
                    Falta el template para este caso.
                  </div>
                </ng-template>
              </div>

              <div class="solution-actions" aria-label="Acciones de solución">
                <button
                  type="button"
                  class="code-toggle"
                  (click)="toggleCode(wcagCase.id)"
                  [attr.aria-pressed]="isCodeRevealed(wcagCase.id)"
                >
                  {{ isCodeRevealed(wcagCase.id) ? 'Ocultar código' : 'Ver código' }}
                </button>
                <button
                  type="button"
                  class="solution-toggle"
                  (click)="toggleSolution(wcagCase.id)"
                  [attr.aria-pressed]="isSolutionRevealed(wcagCase.id)"
                >
                  {{ isSolutionRevealed(wcagCase.id) ? 'Ocultar solución' : 'Mostrar solución' }}
                </button>
              </div>

              <div class="code-section" *ngIf="isCodeRevealed(wcagCase.id)" aria-label="Código fuente del ejemplo">
                <h3 class="code-title">Código (fuente)</h3>
                <p class="code-hint">Se muestra el marcado del template (puede incluir bindings tipo <strong>[attr.id]</strong>).</p>

                <div class="code-grid" [class.single-column]="!isSolutionRevealed(wcagCase.id)">
                  <div class="code-block inaccessible">
                    <h4>❌ No Accesible (código)</h4>
                    <pre><code [textContent]="getTemplateCode(wcagCase.inaccessibleTemplateKey)"></code></pre>
                  </div>

                  <div class="code-block accessible" *ngIf="isSolutionRevealed(wcagCase.id)">
                    <h4>✅ Accesible (código)</h4>
                    <pre><code [textContent]="getTemplateCode(wcagCase.accessibleTemplateKey)"></code></pre>
                  </div>
                </div>
              </div>

              <div class="case-explanation">
                <h4>Explicación</h4>
                <p>{{ wcagCase.explanation }}</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="wcag-footer-info" aria-label="Información adicional">
    <h2>Niveles WCAG</h2>
    <dl>
      <dt><strong>A</strong></dt>
      <dd>Nivel básico de conformidad.</dd>

      <dt><strong>AA</strong></dt>
      <dd>Recomendado. Mejora accesibilidad para la mayoría.</dd>

      <dt><strong>AAA</strong></dt>
      <dd>Máximo nivel. Accesibilidad óptima.</dd>
    </dl>

    <h2>Recursos</h2>
    <ul>
      <li>
        <a href="https://www.w3.org/TR/WCAG21/" target="_blank" rel="noopener noreferrer">
          WCAG 2.1 oficial
        </a>
      </li>
      <li>
        <a href="https://www.w3.org/WAI/" target="_blank" rel="noopener noreferrer">
          Web Accessibility Initiative (WAI)
        </a>
      </li>
      <li>
        <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility" target="_blank" rel="noopener noreferrer">
          MDN Web Accessibility
        </a>
      </li>
    </ul>
  </footer>
</div>

<!-- Hosts all example templates (ng-template does not render). -->
<wcag-case-templates></wcag-case-templates>
